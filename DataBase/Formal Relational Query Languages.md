# 챕터 6: 형식적 관계 쿼리 언어 요약

이 장에서는 SQL 등 실제 데이터베이스 언어의 이론적 기초가 되는 형식적 관계 쿼리 언어들을 소개한다. 구체적으로 관계 대수(Relational Algebra), 튜플 관계 계산(Tuple Relational Calculus), 도메인 관계 계산(Domain Relational Calculus) 세 가지 언어에 대해 설명하며, 이들 언어가 서로 동등한 표현력을 가진다는 사실을 보여준다.
---

## 1. 관계 대수 (Relational Algebra)

관계 대수는 절차적 쿼리 언어로서, 테이블(관계)에 대해 여러 연산을 순차적으로 적용하여 새로운 테이블을 생성한다.

### 1.1 기본 연산

- **선택 (Select, σ):**  
  주어진 조건(예: salary > 80000)에 맞는 튜플을 필터링한다.
  <br>
  예시:  
```scss
σ(dept_name = "Physics" ∧ salary > 90000)(instructor)
```

- **투영 (Project, π):**  
  원하는 속성만 남기고 나머지를 제거하며, 중복 제거 효과가 있다.
  <br>
  예시:  
```scss
π(ID, name, salary)(instructor)

```

- **합집합 (Union, ∪):**  
  두 관계의 튜플을 결합한다. 단, 두 관계는 속성의 수와 도메인이 동일해야 한다.

- **차집합 (Set Difference, −):**  
  한 관계에 있으나 다른 관계에는 없는 튜플을 선택한다.

- **데카르트 곱 (Cartesian Product, ×):**  
  두 관계의 모든 튜플 쌍을 생성한다. 단, 동일한 속성명이 있는 경우 관계 이름을 접두어로 붙여 구분한다.

- **이름 바꾸기 (Rename, ρ):**  
  두 관계의 모든 튜플 쌍을 생성한다. 단, 동일한 속성명이 있는 경우 관계 이름을 접두어로 붙여 구분한다.
    <br>
  예시:  
```scss
ρ(new_name, (A1, A2, ... , An))(E)

```


### 1.2 복합 연산

- **교집합 (Intersection, ∩):**  
두 관계에 공통된 튜플만 남긴다.
(r ∩ s = r − (r − s)로 표현 가능)

- **자연 조인 (Natural Join, ⋈):**  
데카르트 곱 후 공통 속성에 대해 동일한 값을 갖는 튜플만 선택하고, 중복 속성을 제거한다.
예시:  
```scss
π(name, course_id)(instructor ⋈ teaches)
```
<br>

- **세타 조인 (Theta Join, ⋈₍ₚ₎):**  
일반 조건(예: 비교 연산자)을 사용하여 두 관계를 결합.  
`σ(조건)(r × s)`와 동일.

- **외부 조인 (Outer Join):**  
자연 조인에서 매칭되지 않는 튜플 포함, 매칭되지 않은 속성은 NULL
- **왼쪽 외부 조인 (⟕)**
- **오른쪽 외부 조인 (⟖)**
- **전체 외부 조인 (⟗)**

### 1.3 확장 연산

- **일반화 투영 (Generalized Projection):**  
산술 연산, 문자열 결합 등 함수 적용을 허용하여 새로운 속성 생성.  
예시:  
```scss
π(ID, name, dept_name, salary/12)(instructor)
```
<br>

- **집계 연산 (Aggregation, 𝒢):**  
그룹별 집계 함수(`sum`, `avg`, `min`, `max`, `count`)를 적용.  
예시:  
```scss
dept_name 𝒢 avg(salary)(instructor)
```
<br>
또는 전체 튜플에 대해 집계하는 경우 (그룹 없이) 작성 가능.

### 1.4 멀티셋(Relational Multiset) 확장

- SQL과 같이 중복을 허용하는 관계를 모델링하기 위해 멀티셋 관계 대수가 정의된다.
- 선택, 투영, 곱 연산 등에서 중복 튜플의 개수를 고려하며, 집합과 달리 결과 튜플의 개수가 달라질 수 있음.

---

## 2. 튜플 관계 계산 (Tuple Relational Calculus)

튜플 관계 계산은 **비절차적 쿼리 언어**로, "어떤 튜플들의 집합"으로 결과 기술.

### 2.1 기본 문법 및 예제

- **기본 형식:**  
```scss
{ t | P(t) }
```
<br>

- t: 결과 튜플 (특정 속성만 포함)
- P(t): 튜플 t에 대해 참이어야 하는 조건(논리식)

- **예시 1:**  
모든 강사 중 급여가 80,000 초과하는 튜플을 선택

```scss
{ t | t ∈ instructor ∧ t[salary] > 80000 }
```

- **예시 2 (속성 선택):**  
강사의 ID만 반환

```scss
{ t | ∃ s ∈ instructor (t[ID] = s[ID] ∧ s[salary] > 80000) }
```

- **예시 3 (다중 관계 조건):**  
Watson 빌딩에 위치한 학과에 속한 강사의 이름을 반환  

```scss
{ t | ∃ s ∈ instructor (t[name] = s[name] ∧ ∃ u ∈ department (u[dept_name] = s[dept_name] ∧ u[building] = "Watson")) }
```
<br>

### 2.2 안전성 (Safety)

- **안전한 표현식:**  
결과에 포함되는 값은 반드시 표현식에 명시된 도메인(dom(P)) 내의 값이어야 하며, 무한 튜플 생성 X.
- 예시: `{ t | ¬(t ∈ instructor) }`는 안전하지 않음.
- 모든 변수의 범위를 명확한 관계에 한정시켜 안전성을 유지해야 함.

---

## 3. 도메인 관계 계산 (Domain Relational Calculus)

도메인 관계 계산은 튜플 대신 **도메인 변수**(각 속성의 값을 나타내는 변수)를 사용하는 비절차적 언어.

### 3.1 문법 및 예제

- **기본 형식:**  
```scss
{ < x1, x2, ..., xn > | P(x1, x2, ..., xn) }
```
- **원칙:**  
- `<x1, x2, ..., xn> ∈ r` 형태로, 관계 r의 튜플에 포함된 도메인 값들을 표현.
- 비교 연산자와 논리 연산자, ∃, ∀ 등을 사용하여 조건 작성.

- **예시 1:**  
모든 강사 중 급여가 80,000 초과하는 튜플 선택  
```scss
{ < i, n, d, s > | < i, n, d, s > ∈ instructor ∧ s > 80000 }
```
<br>

- **예시 2:**  
물리학과에 속한 강사가 가르치는 강좌의 정보 반환  
```scss
{ < n, c > | ∃ i, a ( < i, c, a, s, y > ∈ teaches ∧ ∃ d, s ( < i, n, d, s > ∈ instructor ∧ d = "Physics" ) ) }
```
<br>

### 3.2 안전성

- **안전한 표현식:**  
- 결과에 나타나는 모든 값은 명시된 도메인 내의 값이어야 한다.
- ∃ 및 ∀와 같은 조건문에서도 도메인이 유한하게 제한되어야 무한한 결과 생성이 방지.
- 튜플 관계 계산과 마찬가지로, 안전한 표현식으로 제한해야 함.

---

## 4. 표현력 및 비교

- **동등한 표현력:**  
- 기본 관계 대수(확장 연산 제외), 안전한 튜플 관계 계산, 안전한 도메인 관계 계산은 서로 동등한 표현력을 가짐.
- 한 언어에서 표현 가능한 쿼리는 다른 두 언어에서도 표현할 수 있음.

- **실제 사용:**  
- 관계 대수는 절차적 접근을 제공하지만, 사용자가 직접 작성하기에는 복잡할 수 있음.
- 튜플/도메인 관계 계산은 "무엇을" 반환할지 기술하는 비절차적 언어로, 이를 바탕으로 QBE, Datalog 등의 사용자 친화적 언어가 개발됨.
- SQL은 이러한 관계 대수의 아이디어를 바탕으로 집계, 중복 관리 등 실용적인 확장을 포함하여 널리 사용된다.

---
