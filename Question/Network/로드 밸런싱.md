# 로드 밸런싱

---

## 면접 질문 예시

> "로드 밸런싱이 무엇인지 설명해주시고, 로드 밸런서가 트래픽을 분산하는 대표적인 알고리즘과, Layer 4, Layer 7 등 주요 종류별 차이점 및 장단점에 대해 말씀해 주실 수 있나요?"

---

<details>
  <summary><h2>평가 요소 및 평가 요소 별 모범 답안</h2></summary>

  ### 1. 로드 밸런싱의 정의 및 목적
  - 포함내용:
    - 정의: 여러 서버(또는 서비스 인스턴스)에 클라이언트 요청을 분산시켜 단일 서버 과부하를 방지하는 기술.
    - 목적: 가용성(Availability), 확장성(Scalability), 성능(Performance) 향상, 장애 허용(Fault Tolerance) 구현.
  - <details>
    <summary>모범 답안 예시 :</summary>
    
      > "로드 밸런싱은 다수의 서버에 들어오는 요청을 효율적으로 분산시켜 한 서버에 과부하가 걸리지 않도록 하고, 전체 시스템의 가용성과 처리량을 높이는 기술입니다. 이를 통해 장애가 발생해도 다른 서버가 서비스 요청을 계속 처리할 수 있습니다."
    </details>

  ### 2. 분산 알고리즘 및 작동 방식
  - 포함내용:
    - Round Robin: 순차적으로 요청을 분배.
    - Weighted Round Robin: 서버별 가중치를 고려하여 분배.
    - Least Connections: 연결 수가 가장 적은 서버에 할당.
    - IP Hash: 클라이언트 IP 해시로 항상 같은 서버로 라우팅.
    - Health Check: 주기적으로 서버 상태를 확인해, 비정상 서버 제외.
  - <details>
    <summary>모범 답안 예시 :</summary>
    
      > "Round Robin은 간단히 순서대로 분배하지만, 서버 성능 차이가 있으면 불균형이 발생할 수 있습니다.   
      > Weighted Round Robin은 성능에 따라 가중치를 주어 보다 균형 있게 분산합니다.   
      > Least Connections는 현재 연결 수가 적은 서버를 선택해, 트래픽이 몰릴 때 유리합니다.   
      > IP Hash는 동일 클라이언트가 항상 같은 서버로 가도록 해 세션 유지에 도움이 되며,
      > Health Check는 주기적으로 서버의 상태를 체크하며 장애 시 자동으로 분산 대상에서 제외합니다."
    </details>

  ### 3. 로드 밸런서 종류 및 차이점
  - 포함내용:
    - Layer 4 (Transport Layer) 로드 밸런싱:
      - 작동 방법 :
        - TCP/UDP 헤더(소스 IP, 소스 포트, 목적지 IP, 목적지 포트)만 보고, 패킷이 들어오는 대로 백엔드로 전달
        - 보통 NAT(Network Address Translation) 방식으로 동작해, 클라이언트의 패킷을 받아서 다른 서버의 IP/포트로 재작성한 뒤 전달하고, 응답도 다시 원래 클라이언트로 되돌려 준다.
      - 장점 :
        - 속도·처리량 우수: 헤더만 보고 판단하므로 오버헤드가 적어 초당 수십만 연결도 처리 가능.
        - 프로토콜 독립적: HTTP뿐 아니라 MySQL, SMTP, DNS 등 모든 TCP/UDP 기반 트래픽에 적용.
      - 단점 :
        - 내용 기반 분산 불가: HTTP URL, 쿠키, 헤더 같은 애플리케이션 레이어 정보는 전혀 보지 못함.
        - 세션 유지 어려움: 연결이 재설정되면 같은 클라이언트의 요청이 다른 서버로 갈 수 있어, Sticky Session을 구현하기 위해 별도 키(예: Source IP) 기반 매핑이 필요.
      - 사용사례:
        - 데이터베이스 프로토콜, 단순 TCP 프록시나, SSL 오프로드 뒤의 내부 서비스 분산.
          
    - Layer 7 (Application Layer) 로드 밸런싱:
      - 작동 방법 :
        - HTTP(S) 요청의 URL 경로, 호스트명, 헤더, 쿠키, 쿼리 파라미터 등 애플리케이션 레이어 데이터를 파싱해서 분산 정책을 적용
        - 보통 리버스 프록시 형태로 동작하며, 클라이언트와 백엔드 서버 사이에서 완전한 HTTP 세션을 중개합니다.
      - 장점 :
        - 세밀한 라우팅 가능: 예를 들어 /api/** 요청은 A 서버 풀로, /static/** 요청은 CDN 계층으로 보내는 등 컨텐츠 타입별 분산이 가능.
        - SSL/TLS 종료 및 리라이트: HTTPS 인증서를 여기서 관리하고, 백엔드에는 평문 HTTP로 전달.
        - 부가 기능 제공: Web Application Firewall, 압축, 캐싱, 요청·응답 변조, 헤더 삽입/삭제 등.
      - 단점 :
        - 오버헤드: HTTP 메시지 전체를 파싱하고, 경우에 따라 콘텐츠까지 검사하므로 CPU 비용과 지연이 커질 수 있음.
        - 프로토콜 제한: HTTP/HTTPS 외에 다른 TCP/UDP 트래픽 분산은 불가능.
      - 사용사례:
        - REST API 서버, 마이크로서비스 아키텍처에서의 경로 기반 라우팅.
  - <details>
    <summary>모범 답안 예시 :</summary>
    
      > "Layer 4 로드 밸런서는 TCP/UDP 헤더(소스·목적지 IP, 포트) 정보만으로 트래픽을 분산합니다. 네트워크 레벨에서 매우 빠르게 동작하며, HTTP뿐 아니라 모든 TCP/UDP 기반 서비스(MySQL, SMTP 등)에 적용할 수 있습니다. 다만 요청 내용은 전혀 해석하지 못하므로, 세션 고정이나 URL 기반 라우팅 같은 고급 기능은 지원하지 않습니다.    
      > 반면 Layer 7 로드 밸런서는 HTTP 헤더, URL 경로, 쿠키, 메서드 등 애플리케이션 계층 데이터를 파싱해 분산합니다. 예를 들어 /api/** 요청은 A 풀로, /static/** 요청은 B 풀로 라우팅하는 식의 세밀한 제어가 가능합니다. 또한 SSL 종료, 압축, 캐싱, WebSocket 프록시와 같은 부가 기능을 제공하지만, HTTP 메시지를 온전히 파싱해야 하므로 Layer 4보다 처리 오버헤드가 크고 지연시간이 길어질 수 있습니다."
    </details>

  ### 4. 심화 지식
  - 포함내용:
    - SSL/TLS 종료(Termination): 로드 밸런서가 클라이언트와 백엔드 사이에서 SSL 핸드셰이크와 암호화·복호화를 처리하는 기능으로 백엔드 서버는 평문 HTTP만 처리하면 돼 CPU 부담이 줄고, 인증서 관리도 로드 밸런서 한 곳에서 집중적으로 할 수 있다.
    - 모니터링 및 로깅: Prometheus, ELK, Grafana 등을 이용한 실시간 트래픽·성능 시각화하여 장애를 조기에 발견하고, 트렌드를 분석.
    - 글로벌 로드 밸런싱: 지리적 위치 기반 분산(GSLB)으로 레이턴시 최적화.
  - <details>
    <summary>모범 답안 예시 :</summary>
    
      > "SSL 종료를 LB에서 하면 백엔드 서버 부담을 줄일 수 있습니다. 또한, Prometheus와 Grafana를 통해 응답 시간, 에러율 등 메트릭을 모니터링하고, GSLB를 사용해 전 세계 사용자에게 가장 가까운 리전으로 트래픽을 분산하면 레이턴시를 최소화할 수 있습니다."
    </details>

</details>
